# AnemiaDetection_web
🩸 결막 이미지 기반 빈혈 예측 웹 앱

이 프로젝트는 웹캠 스트리밍을 통해 사용자의 결막 이미지를 실시간으로 캡처하고, 홍채와 공막을 통해 밝기를 정규화한  딥러닝 모델을 사용하여 빈혈 여부를 예측하는 Streamlit 기반 웹 애플리케이션입니다. 모바일 환경에서도 사용하기 편리하도록 베지어 프레임 가이드를 제공하며, 프레임 안의 결막 영역만 추출하여 홍채와 공막을 통한 밝기 정규화 이후 모델의 입력으로 사용합니다.

🚀 라이브 데모

- **앱 바로가기**: https://anemiadetection.streamlit.app/

✨ 주요 기능

- **실시간 웹캠 스트리밍**: streamlit-webrtc를 활용하여 웹캠 영상을 실시간으로 앱에 표시합니다.

- **프레임 가이드**: 결막 촬영을 위한 최적의 위치를 안내하는 사용자 친화적인 베지어 곡선 프레임을 오버레이합니다. 모바일 환경에 최적화된 프레임 크기와 위치를 제공합니다.

- **자동 결막 영역 추출 및 마스킹**: 촬영된 이미지에서 베지어 프레임 안의 영역만을 자동으로 추출하고, 나머지 배경을 흰색으로 처리하여 모델이 결막 부분에 집중할 수 있도록 전처리합니다.

- **홍채와 공막을 이용한 밝기 정규화**: 촬영 환경(조명, 장소 등)에 따라 이미지 밝기가 다를 수 있으므로, 홍채와 공막을 검출해 공막 밝기 값을 측정한 뒤 전체 이미지를 보정합니다.  

- **딥러닝 기반 빈혈 예측**: 미리 학습된 ResNet18 기반 딥러닝 모델을 사용하여 전처리된 결막 이미지의 빈혈 여부를 예측하고 확률과 함께 결과를 표시합니다.

- **간단한 UI**: Streamlit을 사용하여 사용자가 쉽게 접근하고 상호작용할 수 있는 직관적인 웹 인터페이스를 제공합니다.

💡 사용 방법

1. 앱이 실행되면 'Start camera' 버튼을 클릭하여 웹캠을 켜세요.

2. 카메라 피드에 초록색 베지어 프레임이 나타납니다.

3. 프레임 안에 사용자의 눈 부분에서 결막 부분이 오도록 카메라 각도와 거리를 조절합니다.

4. 이미지 준비가 되면 '사진 찍기 & 예측' 버튼을 클릭합니다.

5. 앱이 프레임 안의 결막 영역을 추출하고 홍채와 공막을 통해 밝기 정규화한 이미지를 모델을 통해 빈혈 여부를 예측하여 결과를 보여줍니다.

6. 모델의 확신도가 낮을 경우, 조명이나 촬영 환경을 개선하여 다시 시도해 주세요.

🛠 기술 스택

- **Python**

- **Streamlit**: 웹 애플리케이션 프레임워크

- **OpenCV**: 이미지 처리

- **PyTorch**: 딥러닝 모델 프레임워크

- **streamlit-webrtc**: 실시간 웹캠 스트리밍
  
- **Numpy**: 수치 계산

- **Pillow (PIL)**: 이미지 처리

---

# 🩸 Anemia Detection using ResNet18

이 프로젝트는 결막 이미지(conjunctiva images)를 기반으로 빈혈 여부를 예측하는 AI 모델을 구축한 것입니다. PyTorch 프레임워크를 사용하여 ResNet18 기반의 이진 분류(Binary Classification) 모델을 훈련하고 평가했습니다.

## 📁 주요 구성
- **ResNet18 모델 구현**: 사전학습된 모델 기반의 전이학습(fine-tuning)
- **이미지 증강**: 학습 데이터 다양성을 확보하기 위한 Albumentations 기반 변환 적용
- **Loss Function**: Focal Loss를 사용하여 불균형 클래스 문제 대응
- **교차 검증**: 5-Fold Cross Validation 적용
- **정확도 향상**: Mixup, EarlyStopping 등 다양한 전략 적용

## 🛠 환경 설정 (Environment)
- Python 3.8+
- torch >= 1.12
- torchvision
- albumentations
- opencv-python
- matplotlib
- scikit-learn

## 📊 모델 성능

모든 Fold에서 한 이미지당 15배의 데이터 증강을 적용하여 모델을 학습했습니다.  
이는 과적합 없이 가장 우수한 성능을 보인 배수로, 여러 배수를 실험한 결과 15배에서 최적의 성능을 확인하였습니다.

| Fold | Accuracy | Precision | Recall | F1 Score |
|------|----------|-----------|--------|----------|
| 1    | 0.8864   | 0.8846    | 0.9200 | 0.9020   |
| 2    | 0.8864   | 0.9545    | 0.8400 | 0.8936   |
| 3    | 0.9773   | 1.0000    | 0.9600 | 0.9796   |
| 4    | 0.9302   | 0.9200    | 0.9583 | 0.9388   |
| 5    | 0.8140   | 0.9000    | 0.7500 | 0.8182   |

총 5개의 Fold 결과에서 전반적으로 높은 정확도와 F1 Score를 달성하였으며, 특히 3번째 Fold에서는 모든 지표가 매우 뛰어난 성능을 보였습니다.

## 데이터 출처 및 참고 논문

본 프로젝트에서 모델에 사용한 결막 이미지 데이터셋은 Kaggle의 Eye-Anemia dataset(https://www.kaggle.com/datasets/nadiwidi/eyeanemia) 에서 가져왔습니다.

[Detection of anemia from image of the anterior conjunctiva of the eye by image processing and thresholding](https://ieeexplore.ieee.org/document/8289053) 논문을 참고하여 진행하였습니다.
